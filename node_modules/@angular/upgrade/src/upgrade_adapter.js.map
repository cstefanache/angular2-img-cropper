{"version":3,"file":"upgrade_adapter.js","sourceRoot":"","sources":["../../../../modules/@angular/upgrade/src/upgrade_adapter.ts"],"names":[],"mappings":"AAAA;;;;;;GAMG;OAEI,EAAC,QAAQ,EAAqC,QAAQ,EAAE,QAAQ,EAAe,MAAM,EAAY,WAAW,EAAO,MAAM,eAAe;OACxI,EAAC,sBAAsB,EAAC,MAAM,mCAAmC;OAEjE,KAAK,OAAO,MAAM,cAAc;OAChC,EAAC,WAAW,EAAE,YAAY,EAAE,SAAS,EAAE,cAAc,EAAE,eAAe,EAAE,YAAY,EAAE,6BAA6B,EAAE,YAAY,EAAE,QAAQ,EAAE,gBAAgB,EAAC,MAAM,aAAa;OACjL,EAAC,4BAA4B,EAAC,MAAM,yBAAyB;OAC7D,EAAgB,gBAAgB,EAAC,MAAM,YAAY;OACnD,EAAC,iCAAiC,EAAC,MAAM,uBAAuB;OAChE,EAAC,aAAa,EAAE,OAAO,EAAC,MAAM,QAAQ;AAE7C,IAAI,YAAY,GAAW,CAAC,CAAC;AAE7B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GA8EG;AACH;IAiBE,wBAAoB,YAAuB,EAAU,eAAiC;QAAlE,iBAAY,GAAZ,YAAY,CAAW;QAAU,oBAAe,GAAf,eAAe,CAAkB;QAhBtF,eAAe;QACP,aAAQ,GAAW,iBAAe,YAAY,EAAE,MAAG,CAAC;QAC5D,eAAe;QACP,uBAAkB,GAAgB,EAAE,CAAC;QAC7C;;;;;;;WAOG;QACK,8BAAyB,GAAwD,EAAE,CAAC;QAC5F,eAAe;QACP,cAAS,GAAe,EAAE,CAAC;QAGjC,EAAE,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC;YAClB,MAAM,IAAI,KAAK,CACX,iFAAiF,CAAC,CAAC;QACzF,CAAC;IACH,CAAC;IAED;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;OAsDG;IACH,8CAAqB,GAArB,UAAsB,IAAe;QACnC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACnC,IAAI,IAAI,GAAkB,gBAAgB,CAAC,IAAI,CAAC,CAAC;QACjD,MAAM,CAAC,qBAAqB,CAAC,IAAI,EAAE,KAAG,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,OAAI,CAAC,CAAC;IAC3E,CAAC;IAED;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;OA4EG;IACH,4CAAmB,GAAnB,UAAoB,IAAY;QAC9B,EAAE,CAAC,CAAO,IAAI,CAAC,yBAA0B,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAC/D,MAAM,CAAC,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC;QACnD,CAAC;QAAC,IAAI,CAAC,CAAC;YACN,MAAM,CAAC,CAAC,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,GAAG,IAAI,iCAAiC,CAAC,IAAI,CAAC,CAAC;iBACtF,IAAI,CAAC;QACZ,CAAC;IACH,CAAC;IAED;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;OA2CG;IACH,kCAAS,GAAT,UAAU,OAAgB,EAAE,OAAe,EAAE,MAAwC;QAArF,iBA8IC;QA5IC,IAAM,MAAM,GACR,IAAI,MAAM,CAAC,EAAC,oBAAoB,EAAE,IAAI,CAAC,cAAc,CAAC,wBAAwB,CAAC,EAAC,CAAC,CAAC;QACtF,IAAI,OAAO,GAAG,IAAI,iBAAiB,EAAE,CAAC;QACtC,IAAI,WAAW,GAA6B,IAAI,CAAC;QACjD,IAAI,SAAS,GAAqB,IAAI,CAAC;QACvC,IAAI,cAAc,GAAe,EAAE,CAAC;QACpC,IAAI,gBAA0B,CAAC;QAC/B,IAAI,kBAAuB,CAAC;QAC5B,IAAI,SAAoC,CAAC;QACzC,IAAI,sBAAsB,GAA2B,EAAE,CAAC;QACxD,IAAI,SAAS,GAAG,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;QACvD,IAAI,mBAAiC,CAAC;QACtC,IAAI,iBAA+B,CAAC;QACpC,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,cAAM,OAAA,SAAS,CAAC,QAAQ,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAhC,CAAgC,CAAC;aAClE,KAAK,CAAC,QAAQ,EAAE,MAAM,CAAC;aACvB,OAAO,CAAC,YAAY,EAAE,cAAM,OAAA,SAAS,CAAC,QAAQ,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAhC,CAAgC,CAAC;aAC7D,KAAK,CAAC,6BAA6B,EAAE,sBAAsB,CAAC;aAC5D,MAAM,CAAC;YACN,UAAU,EAAE,WAAW;YACvB,UAAC,OAAY,CAAC,iBAAiB,EAAE,WAAqC;gBACpE,OAAO,CAAC,SAAS,CAAC,cAAc,EAAE;oBAChC,WAAW;oBACX,UAAS,iBAA4C;wBACnD,4EAA4E;wBAC5E,iEAAiE;wBACjE,kBAAkB,GAAG,iBAAiB,CAAC,WAAW,CAAC,SAAS,CAAC;wBAC7D,EAAE,CAAC,CAAC,kBAAkB,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;4BAChD,gBAAgB,GAAG,kBAAkB,CAAC,MAAM,CAAC;4BAC7C,kBAAkB,CAAC,MAAM,GAAG,UAAC,GAAQ,IAAK,OAAA,cAAc,CAAC,IAAI,CAAC,GAAG,CAAC,EAAxB,CAAwB,CAAC;wBACrE,CAAC;wBAAC,IAAI,CAAC,CAAC;4BACN,MAAM,IAAI,KAAK,CAAC,8CAA8C,CAAC,CAAC;wBAClE,CAAC;wBACD,MAAM,CAAC,SAAS,GAAG,iBAAiB,CAAC;oBACvC,CAAC;iBACF,CAAC,CAAC;gBACH,EAAE,CAAC,CAAC,WAAW,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;oBACrC,OAAO,CAAC,SAAS,CAAC,eAAe,EAAE;wBACjC,WAAW;wBACX,UAAS,mBAAgD;4BAAzD,iBAiBC;4BAfC,IAAI,kBAAkB,GAAa,mBAAmB,CAAC,UAAU,CAAC;4BAClE,IAAI,aAAa,GAAG,UAAC,QAAkB;gCACrC,IAAI,iBAAiB,GAAQ,KAAI,CAAC;gCAClC,kBAAkB,CAAC,IAAI,CAAC,KAAI,EAAE;oCAC5B,IAAI,cAAc,GAAgB,SAAS,CAAC,QAAQ,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;oCACtE,EAAE,CAAC,CAAC,cAAc,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC;wCAC9B,QAAQ,CAAC,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;oCAClC,CAAC;oCAAC,IAAI,CAAC,CAAC;wCACN,cAAc,CAAC,UAAU,CAAC,aAAa,CAAC,IAAI,CAAC,iBAAiB,EAAE,QAAQ,CAAC,CAAC,CAAC;oCAC7E,CAAC;gCACH,CAAC,CAAC,CAAC;4BACL,CAAC,CAAC;4BAEF,mBAAmB,CAAC,UAAU,GAAG,aAAa,CAAC;4BAC/C,MAAM,CAAC,mBAAmB,CAAC;wBAC7B,CAAC;qBACF,CAAC,CAAC;gBACL,CAAC;YACH,CAAC;SACF,CAAC,CAAC;QAEP,iBAAiB,GAAG,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;YAC9C,SAAS,CAAC,GAAG,CAAC;gBACZ,WAAW,EAAE,YAAY;gBACzB,UAAC,QAAkC,EAAE,SAAoC;oBACvE,WAAW,GAAG,QAAQ,CAAC;oBACvB,iCAAiC,CAAC,OAAO,CAAC,KAAI,CAAC,yBAAyB,EAAE,QAAQ,CAAC;yBAC9E,IAAI,CAAC;wBACJ,oFAAoF;wBACpF,yBAAyB;wBACzB,IAAI,sBAAsB,GACtB,QAAQ,CAAC;4BACP,SAAS,EAAE;gCACT,EAAC,OAAO,EAAE,YAAY,EAAE,UAAU,EAAE,cAAM,OAAA,WAAW,EAAX,CAAW,EAAC;gCACtD,EAAC,OAAO,EAAE,WAAW,EAAE,UAAU,EAAE,cAAM,OAAA,WAAW,CAAC,GAAG,CAAC,WAAW,CAAC,EAA5B,CAA4B,EAAC;gCACtE,KAAI,CAAC,SAAS;6BACf;4BACD,OAAO,EAAE,CAAC,KAAI,CAAC,YAAY,CAAC;yBAC7B,CAAC,CAAC,KAAK,CAAC;4BACP,WAAW,EAAE,oCAAmC,CAAC;4BACjD,aAAa,EAAE,cAAY,CAAC;yBAC7B,CAAC,CAAC;wBAEN,sBAAsB,EAAU;6BAC5B,wBAAwB,CACrB,sBAAsB,EAAE,KAAI,CAAC,eAAe,EAAE,MAAM,EACpD,UAAC,kBAA2C;4BAC1C,kBAAkB,CAAC,OAAO,CAAC,UAAC,gBAAuC;gCACjE,IAAI,IAAI,GAAc,gBAAgB,CAAC,aAAa,CAAC;gCACrD,EAAE,CAAC,CAAC,KAAI,CAAC,kBAAkB,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;oCACjD,sBAAsB,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC,QAAQ,CAAC;wCACnD,gBAAgB,CAAC;gCACvB,CAAC;4BACH,CAAC,CAAC,CAAC;wBACL,CAAC,CAAC;6BACL,IAAI,CAAC,UAAC,GAAqB;4BAC1B,SAAS,GAAG,GAAG,CAAC;4BAChB,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,IAAI,CACzB,aAAa,CAAC,YAAY,CAAC,EAAE,SAAS,CAAC,QAAQ,CAAC,CAAC;4BACrD,MAAM,CAAC,gBAAgB,CAAC,SAAS,CAAC;gCAChC,IAAI,EAAE,UAAC,CAAM,IAAK,OAAA,MAAM,CAAC,iBAAiB,CAAC,cAAM,OAAA,SAAS,CAAC,UAAU,EAAE,EAAtB,CAAsB,CAAC,EAAtD,CAAsD;6BACzE,CAAC,CAAC;wBACL,CAAC,CAAC;6BACD,IAAI,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;oBAC7B,CAAC,CAAC,CAAC;gBACT,CAAC;aACF,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,+EAA+E;QAC/E,IAAI,aAAa,GAAI,MAAgC,CAAC,SAAS,CAAC,CAAC;QACjE,aAAa,CAAC,eAAe,GAAG,SAAS,CAAC;QAE1C,MAAM,CAAC,GAAG,CAAC,cAAQ,OAAO,CAAC,SAAS,CAAC,OAAO,EAAE,CAAC,KAAI,CAAC,QAAQ,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAC3E,mBAAmB,GAAG,IAAI,OAAO,CAAC,UAAC,OAAO;YACxC,EAAE,CAAC,CAAC,aAAa,CAAC,eAAe,CAAC,CAAC,CAAC;gBAClC,IAAI,uBAAuB,GAAe,aAAa,CAAC,eAAe,CAAC;gBACxE,aAAa,CAAC,eAAe,GAAG;oBAC9B,aAAa,CAAC,eAAe,GAAG,uBAAuB,CAAC;oBACxD,aAAa,CAAC,eAAe,CAAC,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;oBACrD,OAAO,EAAE,CAAC;gBACZ,CAAC,CAAC;YACJ,CAAC;YAAC,IAAI,CAAC,CAAC;gBACN,OAAO,EAAE,CAAC;YACZ,CAAC;QACH,CAAC,CAAC,CAAC;QAEH,OAAO,CAAC,GAAG,CAAC,CAAC,mBAAmB,EAAE,iBAAiB,CAAC,CAAC,CAAC,IAAI,CAAC;YACzD,SAAS,CAAC,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC;gBACjC,EAAE,CAAC,CAAC,kBAAkB,CAAC,CAAC,CAAC;oBACvB,kBAAkB,CAAC,MAAM,GAAG,gBAAgB,CAAC,CAAE,0BAA0B;oBACzE,OAAO,cAAc,CAAC,MAAM,EAAE,CAAC;wBAC7B,SAAS,CAAC,MAAM,CAAC,cAAc,CAAC,KAAK,EAAE,CAAC,CAAC;oBAC3C,CAAC;oBACK,OAAQ,CAAC,cAAc,CAAC,SAAS,EAAE,WAAW,CAAC,CAAC;oBACtD,kBAAkB,GAAG,IAAI,CAAC;gBAC5B,CAAC;YACH,CAAC,CAAC,CAAC;QACL,CAAC,EAAE,OAAO,CAAC,CAAC;QACZ,MAAM,CAAC,OAAO,CAAC;IACjB,CAAC;IAED;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;OA8BG;IACI,2CAAkB,GAAzB,UAA0B,IAAY,EAAE,OAAwB;QAC9D,IAAI,KAAK,GAAG,OAAO,IAAI,OAAO,CAAC,OAAO,IAAI,IAAI,CAAC;QAC/C,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC;YAClB,OAAO,EAAE,KAAK;YACd,UAAU,EAAE,UAAC,WAAqC,IAAK,OAAA,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,EAArB,CAAqB;YAC5E,IAAI,EAAE,CAAC,YAAY,CAAC;SACrB,CAAC,CAAC;IACL,CAAC;IAED;;;;;;;;;;;;;;;;;;;;OAoBG;IACI,6CAAoB,GAA3B,UAA4B,KAAU;QACpC,IAAI,OAAO,GAAG,UAAS,QAAkB,IAAI,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;QACrE,OAAQ,CAAC,OAAO,GAAG,CAAC,YAAY,CAAC,CAAC;QACxC,MAAM,CAAC,OAAO,CAAC;IACjB,CAAC;IACH,qBAAC;AAAD,CAAC,AAzaD,IAyaC;AAMD,+BAA+B,IAAmB,EAAE,QAAgB;IAC5D,gBAAiB,CAAC,OAAO,GAAG,CAAC,YAAY,EAAE,6BAA6B,EAAE,SAAS,CAAC,CAAC;IAC3F,0BACI,WAAqC,EAAE,sBAA8C,EACrF,KAA4B;QAC9B,IAAI,OAAO,GAAG,CAAC,CAAC;QAChB,MAAM,CAAC;YACL,QAAQ,EAAE,GAAG;YACb,OAAO,EAAE,gBAAgB;YACzB,IAAI,EAAE;gBACJ,IAAI,EAAE,UAAC,KAAqB,EAAE,OAAiC,EAAE,KAA0B,EACpF,cAAmB,EAAE,UAAuC;oBACjE,IAAI,gBAAgB,GAA0B,sBAAsB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;oBACpF,EAAE,CAAC,CAAC,CAAC,gBAAgB,CAAC;wBACpB,MAAM,IAAI,KAAK,CAAC,kCAAkC,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC;oBAEtE,EAAE,CAAC,CAAC,cAAc,KAAK,IAAI,CAAC,CAAC,CAAC;wBAC5B,cAAc,GAAG,WAAW,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;oBACjD,CAAC;oBACD,IAAI,MAAM,GAAG,IAAI,4BAA4B,CACzC,QAAQ,GAAG,CAAC,OAAO,EAAE,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAY,cAAc,EAAE,KAAK,EACpF,gBAAgB,CAAC,CAAC;oBACtB,MAAM,CAAC,WAAW,EAAE,CAAC;oBACrB,MAAM,CAAC,YAAY,EAAE,CAAC;oBACtB,MAAM,CAAC,cAAc,EAAE,CAAC;oBACxB,MAAM,CAAC,YAAY,EAAE,CAAC;oBACtB,MAAM,CAAC,eAAe,EAAE,CAAC;gBAC3B,CAAC;aACF;SACF,CAAC;IACJ,CAAC;IACD,MAAM,CAAC,gBAAgB,CAAC;AAC1B,CAAC;AAED;;;;GAIG;AACH;IAAA;QACE,eAAe;QACP,aAAQ,GAAoD,IAAI,CAAC;QAElE,iBAAY,GAA8B,IAAI,CAAC;QAC/C,gBAAW,GAA6B,IAAI,CAAC;QAC7C,iBAAY,GAAqB,IAAI,CAAC;QACtC,gBAAW,GAAa,IAAI,CAAC;IA2BtC,CAAC;IAzBC,eAAe;IACP,0CAAc,GAAtB,UAAuB,WAA6B,EAAE,WAAqC;QACzF,IAAI,CAAC,YAAY,GAAG,WAAW,CAAC;QAChC,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC,QAAQ,CAAC;QACxC,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;QAC/B,IAAI,CAAC,YAAY,GAAG,WAAW,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;QACpD,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;IACvC,CAAC;IAED;;;;;;OAMG;IACI,iCAAK,GAAZ,UAAa,EAAmD,IAAI,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC,CAAC,CAAC;IAEzF;;OAEG;IACI,mCAAO,GAAd;QACE,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC,QAAQ,EAAE,CAAC;QAChD,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,CAAC;IAC9B,CAAC;IACH,wBAAC;AAAD,CAAC,AAlCD,IAkCC","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {Compiler, CompilerOptions, ComponentFactory, Injector, NgModule, NgModuleRef, NgZone, Provider, Testability, Type} from '@angular/core';\nimport {platformBrowserDynamic} from '@angular/platform-browser-dynamic';\n\nimport * as angular from './angular_js';\nimport {NG1_COMPILE, NG1_INJECTOR, NG1_PARSE, NG1_ROOT_SCOPE, NG1_TESTABILITY, NG2_COMPILER, NG2_COMPONENT_FACTORY_REF_MAP, NG2_INJECTOR, NG2_ZONE, REQUIRE_INJECTOR} from './constants';\nimport {DowngradeNg2ComponentAdapter} from './downgrade_ng2_adapter';\nimport {ComponentInfo, getComponentInfo} from './metadata';\nimport {UpgradeNg1ComponentAdapterBuilder} from './upgrade_ng1_adapter';\nimport {controllerKey, onError} from './util';\n\nvar upgradeCount: number = 0;\n\n/**\n * Use `UpgradeAdapter` to allow AngularJS v1 and Angular v2 to coexist in a single application.\n *\n * The `UpgradeAdapter` allows:\n * 1. creation of Angular v2 component from AngularJS v1 component directive\n *    (See [UpgradeAdapter#upgradeNg1Component()])\n * 2. creation of AngularJS v1 directive from Angular v2 component.\n *    (See [UpgradeAdapter#downgradeNg2Component()])\n * 3. Bootstrapping of a hybrid Angular application which contains both of the frameworks\n *    coexisting in a single application.\n *\n * ## Mental Model\n *\n * When reasoning about how a hybrid application works it is useful to have a mental model which\n * describes what is happening and explains what is happening at the lowest level.\n *\n * 1. There are two independent frameworks running in a single application, each framework treats\n *    the other as a black box.\n * 2. Each DOM element on the page is owned exactly by one framework. Whichever framework\n *    instantiated the element is the owner. Each framework only updates/interacts with its own\n *    DOM elements and ignores others.\n * 3. AngularJS v1 directives always execute inside AngularJS v1 framework codebase regardless of\n *    where they are instantiated.\n * 4. Angular v2 components always execute inside Angular v2 framework codebase regardless of\n *    where they are instantiated.\n * 5. An AngularJS v1 component can be upgraded to an Angular v2 component. This creates an\n *    Angular v2 directive, which bootstraps the AngularJS v1 component directive in that location.\n * 6. An Angular v2 component can be downgraded to an AngularJS v1 component directive. This creates\n *    an AngularJS v1 directive, which bootstraps the Angular v2 component in that location.\n * 7. Whenever an adapter component is instantiated the host element is owned by the framework\n *    doing the instantiation. The other framework then instantiates and owns the view for that\n *    component. This implies that component bindings will always follow the semantics of the\n *    instantiation framework. The syntax is always that of Angular v2 syntax.\n * 8. AngularJS v1 is always bootstrapped first and owns the bottom most view.\n * 9. The new application is running in Angular v2 zone, and therefore it no longer needs calls to\n *    `$apply()`.\n *\n * ### Example\n *\n * ```\n * var adapter = new UpgradeAdapter(forwardRef(() => MyNg2Module), myCompilerOptions);\n * var module = angular.module('myExample', []);\n * module.directive('ng2Comp', adapter.downgradeNg2Component(Ng2Component));\n *\n * module.directive('ng1Hello', function() {\n *   return {\n *      scope: { title: '=' },\n *      template: 'ng1[Hello {{title}}!](<span ng-transclude></span>)'\n *   };\n * });\n *\n *\n * @Component({\n *   selector: 'ng2-comp',\n *   inputs: ['name'],\n *   template: 'ng2[<ng1-hello [title]=\"name\">transclude</ng1-hello>](<ng-content></ng-content>)',\n *   directives:\n * })\n * class Ng2Component {\n * }\n *\n * @NgModule({\n *   declarations: [Ng2Component, adapter.upgradeNg1Component('ng1Hello')],\n *   imports: [BrowserModule]\n * })\n * class MyNg2Module {}\n *\n *\n * document.body.innerHTML = '<ng2-comp name=\"World\">project</ng2-comp>';\n *\n * adapter.bootstrap(document.body, ['myExample']).ready(function() {\n *   expect(document.body.textContent).toEqual(\n *       \"ng2[ng1[Hello World!](transclude)](project)\");\n * });\n *\n * ```\n *\n * @stable\n */\nexport class UpgradeAdapter {\n  /* @internal */\n  private idPrefix: string = `NG2_UPGRADE_${upgradeCount++}_`;\n  /* @internal */\n  private upgradedComponents: Type<any>[] = [];\n  /**\n   * An internal map of ng1 components which need to up upgraded to ng2.\n   *\n   * We can't upgrade until injector is instantiated and we can retrieve the component metadata.\n   * For this reason we keep a list of components to upgrade until ng1 injector is bootstrapped.\n   *\n   * @internal\n   */\n  private ng1ComponentsToBeUpgraded: {[name: string]: UpgradeNg1ComponentAdapterBuilder} = {};\n  /* @internal */\n  private providers: Provider[] = [];\n\n  constructor(private ng2AppModule: Type<any>, private compilerOptions?: CompilerOptions) {\n    if (!ng2AppModule) {\n      throw new Error(\n          'UpgradeAdapter cannot be instantiated without an NgModule of the Angular 2 app.');\n    }\n  }\n\n  /**\n   * Allows Angular v2 Component to be used from AngularJS v1.\n   *\n   * Use `downgradeNg2Component` to create an AngularJS v1 Directive Definition Factory from\n   * Angular v2 Component. The adapter will bootstrap Angular v2 component from within the\n   * AngularJS v1 template.\n   *\n   * ## Mental Model\n   *\n   * 1. The component is instantiated by being listed in AngularJS v1 template. This means that the\n   *    host element is controlled by AngularJS v1, but the component's view will be controlled by\n   *    Angular v2.\n   * 2. Even thought the component is instantiated in AngularJS v1, it will be using Angular v2\n   *    syntax. This has to be done, this way because we must follow Angular v2 components do not\n   *    declare how the attributes should be interpreted.\n   *\n   * ## Supported Features\n   *\n   * - Bindings:\n   *   - Attribute: `<comp name=\"World\">`\n   *   - Interpolation:  `<comp greeting=\"Hello {{name}}!\">`\n   *   - Expression:  `<comp [name]=\"username\">`\n   *   - Event:  `<comp (close)=\"doSomething()\">`\n   * - Content projection: yes\n   *\n   * ### Example\n   *\n   * ```\n   * var adapter = new UpgradeAdapter(forwardRef(() => MyNg2Module));\n   * var module = angular.module('myExample', []);\n   * module.directive('greet', adapter.downgradeNg2Component(Greeter));\n   *\n   * @Component({\n   *   selector: 'greet',\n   *   template: '{{salutation}} {{name}}! - <ng-content></ng-content>'\n   * })\n   * class Greeter {\n   *   @Input() salutation: string;\n   *   @Input() name: string;\n   * }\n   *\n   * @NgModule({\n   *   declarations: [Greeter],\n   *   imports: [BrowserModule]\n   * })\n   * class MyNg2Module {}\n   *\n   * document.body.innerHTML =\n   *   'ng1 template: <greet salutation=\"Hello\" [name]=\"world\">text</greet>';\n   *\n   * adapter.bootstrap(document.body, ['myExample']).ready(function() {\n   *   expect(document.body.textContent).toEqual(\"ng1 template: Hello world! - text\");\n   * });\n   * ```\n   */\n  downgradeNg2Component(type: Type<any>): Function {\n    this.upgradedComponents.push(type);\n    var info: ComponentInfo = getComponentInfo(type);\n    return ng1ComponentDirective(info, `${this.idPrefix}${info.selector}_c`);\n  }\n\n  /**\n   * Allows AngularJS v1 Component to be used from Angular v2.\n   *\n   * Use `upgradeNg1Component` to create an Angular v2 component from AngularJS v1 Component\n   * directive. The adapter will bootstrap AngularJS v1 component from within the Angular v2\n   * template.\n   *\n   * ## Mental Model\n   *\n   * 1. The component is instantiated by being listed in Angular v2 template. This means that the\n   *    host element is controlled by Angular v2, but the component's view will be controlled by\n   *    AngularJS v1.\n   *\n   * ## Supported Features\n   *\n   * - Bindings:\n   *   - Attribute: `<comp name=\"World\">`\n   *   - Interpolation:  `<comp greeting=\"Hello {{name}}!\">`\n   *   - Expression:  `<comp [name]=\"username\">`\n   *   - Event:  `<comp (close)=\"doSomething()\">`\n   * - Transclusion: yes\n   * - Only some of the features of\n   *   [Directive Definition Object](https://docs.angularjs.org/api/ng/service/$compile) are\n   *   supported:\n   *   - `compile`: not supported because the host element is owned by Angular v2, which does\n   *     not allow modifying DOM structure during compilation.\n   *   - `controller`: supported. (NOTE: injection of `$attrs` and `$transclude` is not supported.)\n   *   - `controllerAs': supported.\n   *   - `bindToController': supported.\n   *   - `link': supported. (NOTE: only pre-link function is supported.)\n   *   - `name': supported.\n   *   - `priority': ignored.\n   *   - `replace': not supported.\n   *   - `require`: supported.\n   *   - `restrict`: must be set to 'E'.\n   *   - `scope`: supported.\n   *   - `template`: supported.\n   *   - `templateUrl`: supported.\n   *   - `terminal`: ignored.\n   *   - `transclude`: supported.\n   *\n   *\n   * ### Example\n   *\n   * ```\n   * var adapter = new UpgradeAdapter(forwardRef(() => MyNg2Module));\n   * var module = angular.module('myExample', []);\n   *\n   * module.directive('greet', function() {\n   *   return {\n   *     scope: {salutation: '=', name: '=' },\n   *     template: '{{salutation}} {{name}}! - <span ng-transclude></span>'\n   *   };\n   * });\n   *\n   * module.directive('ng2', adapter.downgradeNg2Component(Ng2Component));\n   *\n   * @Component({\n   *   selector: 'ng2',\n   *   template: 'ng2 template: <greet salutation=\"Hello\" [name]=\"world\">text</greet>'\n   * })\n   * class Ng2Component {\n   * }\n   *\n   * @NgModule({\n   *   declarations: [Ng2Component, adapter.upgradeNg1Component('greet')],\n   *   imports: [BrowserModule]\n   * })\n   * class MyNg2Module {}\n   *\n   * document.body.innerHTML = '<ng2></ng2>';\n   *\n   * adapter.bootstrap(document.body, ['myExample']).ready(function() {\n   *   expect(document.body.textContent).toEqual(\"ng2 template: Hello world! - text\");\n   * });\n   * ```\n   */\n  upgradeNg1Component(name: string): Type<any> {\n    if ((<any>this.ng1ComponentsToBeUpgraded).hasOwnProperty(name)) {\n      return this.ng1ComponentsToBeUpgraded[name].type;\n    } else {\n      return (this.ng1ComponentsToBeUpgraded[name] = new UpgradeNg1ComponentAdapterBuilder(name))\n          .type;\n    }\n  }\n\n  /**\n   * Bootstrap a hybrid AngularJS v1 / Angular v2 application.\n   *\n   * This `bootstrap` method is a direct replacement (takes same arguments) for AngularJS v1\n   * [`bootstrap`](https://docs.angularjs.org/api/ng/function/angular.bootstrap) method. Unlike\n   * AngularJS v1, this bootstrap is asynchronous.\n   *\n   * ### Example\n   *\n   * ```\n   * var adapter = new UpgradeAdapter();\n   * var module = angular.module('myExample', []);\n   * module.directive('ng2', adapter.downgradeNg2Component(Ng2));\n   *\n   * module.directive('ng1', function() {\n   *   return {\n   *      scope: { title: '=' },\n   *      template: 'ng1[Hello {{title}}!](<span ng-transclude></span>)'\n   *   };\n   * });\n   *\n   *\n   * @Component({\n   *   selector: 'ng2',\n   *   inputs: ['name'],\n   *   template: 'ng2[<ng1 [title]=\"name\">transclude</ng1>](<ng-content></ng-content>)'\n   * })\n   * class Ng2 {\n   * }\n   *\n   * @NgModule({\n   *   declarations: [Ng2, adapter.upgradeNg1Component('ng1')],\n   *   imports: [BrowserModule]\n   * })\n   * class MyNg2Module {}\n   *\n   * document.body.innerHTML = '<ng2 name=\"World\">project</ng2>';\n   *\n   * adapter.bootstrap(document.body, ['myExample']).ready(function() {\n   *   expect(document.body.textContent).toEqual(\n   *       \"ng2[ng1[Hello World!](transclude)](project)\");\n   * });\n   * ```\n   */\n  bootstrap(element: Element, modules?: any[], config?: angular.IAngularBootstrapConfig):\n      UpgradeAdapterRef {\n    const ngZone =\n        new NgZone({enableLongStackTrace: Zone.hasOwnProperty('longStackTraceZoneSpec')});\n    var upgrade = new UpgradeAdapterRef();\n    var ng1Injector: angular.IInjectorService = null;\n    var moduleRef: NgModuleRef<any> = null;\n    var delayApplyExps: Function[] = [];\n    var original$applyFn: Function;\n    var rootScopePrototype: any;\n    var rootScope: angular.IRootScopeService;\n    var componentFactoryRefMap: ComponentFactoryRefMap = {};\n    var ng1Module = angular.module(this.idPrefix, modules);\n    var ng1BootstrapPromise: Promise<any>;\n    var ng1compilePromise: Promise<any>;\n    ng1Module.factory(NG2_INJECTOR, () => moduleRef.injector.get(Injector))\n        .value(NG2_ZONE, ngZone)\n        .factory(NG2_COMPILER, () => moduleRef.injector.get(Compiler))\n        .value(NG2_COMPONENT_FACTORY_REF_MAP, componentFactoryRefMap)\n        .config([\n          '$provide', '$injector',\n          (provide: any /** TODO #???? */, ng1Injector: angular.IInjectorService) => {\n            provide.decorator(NG1_ROOT_SCOPE, [\n              '$delegate',\n              function(rootScopeDelegate: angular.IRootScopeService) {\n                // Capture the root apply so that we can delay first call to $apply until we\n                // bootstrap Angular 2 and then we replay and restore the $apply.\n                rootScopePrototype = rootScopeDelegate.constructor.prototype;\n                if (rootScopePrototype.hasOwnProperty('$apply')) {\n                  original$applyFn = rootScopePrototype.$apply;\n                  rootScopePrototype.$apply = (exp: any) => delayApplyExps.push(exp);\n                } else {\n                  throw new Error('Failed to find \\'$apply\\' on \\'$rootScope\\'!');\n                }\n                return rootScope = rootScopeDelegate;\n              }\n            ]);\n            if (ng1Injector.has(NG1_TESTABILITY)) {\n              provide.decorator(NG1_TESTABILITY, [\n                '$delegate',\n                function(testabilityDelegate: angular.ITestabilityService) {\n\n                  var originalWhenStable: Function = testabilityDelegate.whenStable;\n                  var newWhenStable = (callback: Function): void => {\n                    var whenStableContext: any = this;\n                    originalWhenStable.call(this, function() {\n                      var ng2Testability: Testability = moduleRef.injector.get(Testability);\n                      if (ng2Testability.isStable()) {\n                        callback.apply(this, arguments);\n                      } else {\n                        ng2Testability.whenStable(newWhenStable.bind(whenStableContext, callback));\n                      }\n                    });\n                  };\n\n                  testabilityDelegate.whenStable = newWhenStable;\n                  return testabilityDelegate;\n                }\n              ]);\n            }\n          }\n        ]);\n\n    ng1compilePromise = new Promise((resolve, reject) => {\n      ng1Module.run([\n        '$injector', '$rootScope',\n        (injector: angular.IInjectorService, rootScope: angular.IRootScopeService) => {\n          ng1Injector = injector;\n          UpgradeNg1ComponentAdapterBuilder.resolve(this.ng1ComponentsToBeUpgraded, injector)\n              .then(() => {\n                // At this point we have ng1 injector and we have lifted ng1 components into ng2, we\n                // now can bootstrap ng2.\n                var DynamicNgUpgradeModule =\n                    NgModule({\n                      providers: [\n                        {provide: NG1_INJECTOR, useFactory: () => ng1Injector},\n                        {provide: NG1_COMPILE, useFactory: () => ng1Injector.get(NG1_COMPILE)},\n                        this.providers\n                      ],\n                      imports: [this.ng2AppModule]\n                    }).Class({\n                      constructor: function DynamicNgUpgradeModule() {},\n                      ngDoBootstrap: function() {}\n                    });\n\n                (platformBrowserDynamic() as any)\n                    ._bootstrapModuleWithZone(\n                        DynamicNgUpgradeModule, this.compilerOptions, ngZone,\n                        (componentFactories: ComponentFactory<any>[]) => {\n                          componentFactories.forEach((componentFactory: ComponentFactory<any>) => {\n                            var type: Type<any> = componentFactory.componentType;\n                            if (this.upgradedComponents.indexOf(type) !== -1) {\n                              componentFactoryRefMap[getComponentInfo(type).selector] =\n                                  componentFactory;\n                            }\n                          });\n                        })\n                    .then((ref: NgModuleRef<any>) => {\n                      moduleRef = ref;\n                      angular.element(element).data(\n                          controllerKey(NG2_INJECTOR), moduleRef.injector);\n                      ngZone.onMicrotaskEmpty.subscribe({\n                        next: (_: any) => ngZone.runOutsideAngular(() => rootScope.$evalAsync())\n                      });\n                    })\n                    .then(resolve, reject);\n              });\n        }\n      ]);\n    });\n\n    // Make sure resumeBootstrap() only exists if the current bootstrap is deferred\n    var windowAngular = (window as any /** TODO #???? */)['angular'];\n    windowAngular.resumeBootstrap = undefined;\n\n    ngZone.run(() => { angular.bootstrap(element, [this.idPrefix], config); });\n    ng1BootstrapPromise = new Promise((resolve) => {\n      if (windowAngular.resumeBootstrap) {\n        var originalResumeBootstrap: () => void = windowAngular.resumeBootstrap;\n        windowAngular.resumeBootstrap = function() {\n          windowAngular.resumeBootstrap = originalResumeBootstrap;\n          windowAngular.resumeBootstrap.apply(this, arguments);\n          resolve();\n        };\n      } else {\n        resolve();\n      }\n    });\n\n    Promise.all([ng1BootstrapPromise, ng1compilePromise]).then(() => {\n      moduleRef.injector.get(NgZone).run(() => {\n        if (rootScopePrototype) {\n          rootScopePrototype.$apply = original$applyFn;  // restore original $apply\n          while (delayApplyExps.length) {\n            rootScope.$apply(delayApplyExps.shift());\n          }\n          (<any>upgrade)._bootstrapDone(moduleRef, ng1Injector);\n          rootScopePrototype = null;\n        }\n      });\n    }, onError);\n    return upgrade;\n  }\n\n  /**\n   * Allows AngularJS v1 service to be accessible from Angular v2.\n   *\n   *\n   * ### Example\n   *\n   * ```\n   * class Login { ... }\n   * class Server { ... }\n   *\n   * @Injectable()\n   * class Example {\n   *   constructor(@Inject('server') server, login: Login) {\n   *     ...\n   *   }\n   * }\n   *\n   * var module = angular.module('myExample', []);\n   * module.service('server', Server);\n   * module.service('login', Login);\n   *\n   * var adapter = new UpgradeAdapter();\n   * adapter.upgradeNg1Provider('server');\n   * adapter.upgradeNg1Provider('login', {asToken: Login});\n   *\n   * adapter.bootstrap(document.body, ['myExample']).ready((ref) => {\n   *   var example: Example = ref.ng2Injector.get(Example);\n   * });\n   *\n   * ```\n   */\n  public upgradeNg1Provider(name: string, options?: {asToken: any}) {\n    var token = options && options.asToken || name;\n    this.providers.push({\n      provide: token,\n      useFactory: (ng1Injector: angular.IInjectorService) => ng1Injector.get(name),\n      deps: [NG1_INJECTOR]\n    });\n  }\n\n  /**\n   * Allows Angular v2 service to be accessible from AngularJS v1.\n   *\n   *\n   * ### Example\n   *\n   * ```\n   * class Example {\n   * }\n   *\n   * var adapter = new UpgradeAdapter();\n   *\n   * var module = angular.module('myExample', []);\n   * module.factory('example', adapter.downgradeNg2Provider(Example));\n   *\n   * adapter.bootstrap(document.body, ['myExample']).ready((ref) => {\n   *   var example: Example = ref.ng1Injector.get('example');\n   * });\n   *\n   * ```\n   */\n  public downgradeNg2Provider(token: any): Function {\n    var factory = function(injector: Injector) { return injector.get(token); };\n    (<any>factory).$inject = [NG2_INJECTOR];\n    return factory;\n  }\n}\n\ninterface ComponentFactoryRefMap {\n  [selector: string]: ComponentFactory<any>;\n}\n\nfunction ng1ComponentDirective(info: ComponentInfo, idPrefix: string): Function {\n  (<any>directiveFactory).$inject = [NG1_INJECTOR, NG2_COMPONENT_FACTORY_REF_MAP, NG1_PARSE];\n  function directiveFactory(\n      ng1Injector: angular.IInjectorService, componentFactoryRefMap: ComponentFactoryRefMap,\n      parse: angular.IParseService): angular.IDirective {\n    var idCount = 0;\n    return {\n      restrict: 'E',\n      require: REQUIRE_INJECTOR,\n      link: {\n        post: (scope: angular.IScope, element: angular.IAugmentedJQuery, attrs: angular.IAttributes,\n               parentInjector: any, transclude: angular.ITranscludeFunction): void => {\n          var componentFactory: ComponentFactory<any> = componentFactoryRefMap[info.selector];\n          if (!componentFactory)\n            throw new Error('Expecting ComponentFactory for: ' + info.selector);\n\n          if (parentInjector === null) {\n            parentInjector = ng1Injector.get(NG2_INJECTOR);\n          }\n          var facade = new DowngradeNg2ComponentAdapter(\n              idPrefix + (idCount++), info, element, attrs, scope, <Injector>parentInjector, parse,\n              componentFactory);\n          facade.setupInputs();\n          facade.bootstrapNg2();\n          facade.projectContent();\n          facade.setupOutputs();\n          facade.registerCleanup();\n        }\n      }\n    };\n  }\n  return directiveFactory;\n}\n\n/**\n * Use `UpgradeAdapterRef` to control a hybrid AngularJS v1 / Angular v2 application.\n *\n * @stable\n */\nexport class UpgradeAdapterRef {\n  /* @internal */\n  private _readyFn: (upgradeAdapterRef?: UpgradeAdapterRef) => void = null;\n\n  public ng1RootScope: angular.IRootScopeService = null;\n  public ng1Injector: angular.IInjectorService = null;\n  public ng2ModuleRef: NgModuleRef<any> = null;\n  public ng2Injector: Injector = null;\n\n  /* @internal */\n  private _bootstrapDone(ngModuleRef: NgModuleRef<any>, ng1Injector: angular.IInjectorService) {\n    this.ng2ModuleRef = ngModuleRef;\n    this.ng2Injector = ngModuleRef.injector;\n    this.ng1Injector = ng1Injector;\n    this.ng1RootScope = ng1Injector.get(NG1_ROOT_SCOPE);\n    this._readyFn && this._readyFn(this);\n  }\n\n  /**\n   * Register a callback function which is notified upon successful hybrid AngularJS v1 / Angular v2\n   * application has been bootstrapped.\n   *\n   * The `ready` callback function is invoked inside the Angular v2 zone, therefore it does not\n   * require a call to `$apply()`.\n   */\n  public ready(fn: (upgradeAdapterRef?: UpgradeAdapterRef) => void) { this._readyFn = fn; }\n\n  /**\n   * Dispose of running hybrid AngularJS v1 / Angular v2 application.\n   */\n  public dispose() {\n    this.ng1Injector.get(NG1_ROOT_SCOPE).$destroy();\n    this.ng2ModuleRef.destroy();\n  }\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}